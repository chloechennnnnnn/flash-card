<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocab Studio | Ultimate</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Ëé´Ëò≠Ëø™ÈÖçËâ≤ */
            --bg-gradient: linear-gradient(135deg, #fdfbf7 0%, #e8e0d5 100%);
            --glass: rgba(255, 255, 255, 0.95);
            --primary-brown: #8C7B70;
            --secondary-beige: #B8AFA6;
            --text-dark: #5E5044;
            --text-light: #8D8276;
            --link-blue: #708c85; 
            --star-gold: #D4AF37; /* ÈáëËâ≤Áî®ÊñºÊ®ôË®ò */
            --edit-blue: #6d8299; /* Á∑®ËºØÊåâÈàïËâ≤ */
        }

        body {
            font-family: 'Lato', sans-serif;
            background: var(--bg-gradient);
            color: var(--text-dark);
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        h1, h2, h3 { font-family: 'Playfair Display', serif; color: var(--primary-brown); margin: 0 0 15px 0;}

        /* Âç°ÁâáÂÆπÂô® */
        .card-container {
            width: 100%; max-width: 700px;
            background: var(--glass);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 15px 35px rgba(94, 80, 68, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.6);
            transition: 0.3s;
            position: relative;
        }

        /* ÁôªÂÖ•Áï´Èù¢ */
        .login-box { text-align: center; padding: 60px 40px; }

        /* Â∞éË¶ΩÂàó */
        .nav-bar { display: flex; justify-content: center; gap: 20px; margin-bottom: 25px; border-bottom: 1px solid #eaddcf; padding-bottom: 15px;}
        .nav-btn {
            background: transparent; border: none; color: var(--text-light);
            font-size: 1rem; cursor: pointer; padding: 5px 10px;
            font-family: 'Playfair Display', serif; transition: 0.3s; position: relative;
        }
        .nav-btn.active { color: var(--primary-brown); font-weight: bold; }
        .nav-btn.active::after {
            content: ''; position: absolute; bottom: -15px; left: 0; width: 100%; height: 3px; background: var(--primary-brown); border-radius: 2px;
        }

        /* Ëº∏ÂÖ•ËàáÊåâÈàï */
        input, select, textarea {
            width: 100%; padding: 12px; margin-bottom: 12px;
            border: 1px solid #dcd3cb; border-radius: 8px;
            font-size: 1rem; outline: none; box-sizing: border-box;
            background: #fcfcfc; color: var(--text-dark); font-family: inherit;
        }
        input:focus, textarea:focus { border-color: var(--primary-brown); background: white; }

        .btn {
            width: 100%; padding: 12px;
            background: var(--primary-brown); color: white; border: none;
            border-radius: 8px; font-size: 1rem; font-weight: bold;
            cursor: pointer; transition: 0.2s; letter-spacing: 1px; text-transform: uppercase;
        }
        .btn:hover { background: #6d5f56; transform: translateY(-1px); }
        .btn-outline { background: transparent; border: 1px solid var(--primary-brown); color: var(--primary-brown); }
        .btn-outline:hover { background: var(--primary-brown); color: white; }
        
        .btn-mark { background: transparent; border: 1px solid var(--star-gold); color: var(--star-gold); }
        .btn-mark:hover { background: var(--star-gold); color: white; }

        .row { display: flex; gap: 10px; }
        .small-btn { flex: 1; font-size: 0.9rem; }

        /* ÂàóË°®Ê®£Âºè */
        .word-list { margin-top: 25px; max-height: 400px; overflow-y: auto; padding-right: 5px; }
        .word-list::-webkit-scrollbar { width: 4px; }
        .word-list::-webkit-scrollbar-thumb { background-color: var(--secondary-beige); border-radius: 2px; }

        .word-item {
            background: rgba(255,255,255,0.7);
            padding: 12px 15px; border-radius: 8px; margin-bottom: 10px;
            border-left: 4px solid var(--primary-brown);
            display: flex; justify-content: space-between; align-items: center;
        }
        
        /* Êìç‰ΩúÊåâÈàïÁæ§ */
        .action-group { display: flex; align-items: center; gap: 10px; }

        .cambridge-link {
            text-decoration: none; color: white; background-color: var(--link-blue);
            width: 24px; height: 24px; display: inline-flex; align-items: center; justify-content: center;
            border-radius: 4px; font-size: 14px; font-weight: bold; font-family: serif;
        }
        .edit-btn { color: var(--edit-blue); background: none; border: none; cursor: pointer; font-size: 0.9rem; font-weight: bold;}
        .del-btn { color: var(--text-light); background: none; border: none; cursor: pointer; font-size: 1.2rem; }
        
        /* Èõ£Â≠óÊòüÊòü */
        .star-badge { color: var(--star-gold); font-size: 0.85rem; font-weight: bold; display: flex; align-items: center; gap: 3px;}

        /* 3D Flashcard */
        .scene { width: 100%; height: 280px; perspective: 1000px; margin-bottom: 20px; cursor: pointer; }
        .card-3d { width: 100%; height: 100%; position: relative; transition: transform 0.6s cubic-bezier(0.4, 0.2, 0.2, 1); transform-style: preserve-3d; border-radius: 15px; box-shadow: 0 10px 30px rgba(140, 123, 112, 0.15); }
        .card-3d.is-flipped { transform: rotateY(180deg); }
        .card-face { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 15px; padding: 20px; box-sizing: border-box; }
        
        .face-front { background: #fdfbf9; color: var(--text-dark); border: 1px solid #eaddcf; }
        .face-back { background: var(--primary-brown); color: white; transform: rotateY(180deg); }
        
        .fc-word { font-size: 2.2rem; font-weight: bold; font-family: 'Playfair Display', serif; }
        .fc-pos { color: var(--text-light); font-size: 1rem; margin-top: 5px; font-style: italic; }
        .face-back .fc-word { color: white; font-size: 1.8rem; }
        .fc-ex { margin-top: 20px; font-style: italic; font-size: 0.95rem; background: rgba(255,255,255,0.15); padding: 15px; border-radius: 10px; line-height: 1.5; max-width: 90%; }

        /* Â∞éË¶ΩÊåâÈàïÂçÄ */
        .fc-controls { display: flex; gap: 10px; justify-content: center; margin-top: 10px; }
        .fc-controls .btn { width: auto; padding: 10px 20px; }

        /* Import Box */
        .bulk-box { background: #f8f6f2; border: 1px dashed #dcd3cb; padding: 20px; border-radius: 12px; margin-top: 30px; position: relative; }
        .loading-overlay {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: rgba(255,255,255,0.8); border-radius: 12px;
            display: flex; justify-content: center; align-items: center;
            font-weight: bold; color: var(--primary-brown);
        }

        .hidden { display: none; }
        .user-badge { position: absolute; top: 30px; right: 40px; font-size: 0.9rem; color: var(--text-light); cursor: pointer; border-bottom: 1px solid var(--text-light); }
        
        /* ÊéíÂ∫èÂàáÊèõÂçÄ */
        .sort-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-size: 0.9rem; color: var(--text-light); }
    </style>
</head>
<body>

    <div class="card-container login-box" id="loginPanel">
        <h1 style="font-size: 2.5rem; margin-bottom: 10px;">Vocab Studio</h1>
        <p style="color:var(--text-light); margin-bottom: 40px; font-style: italic;">Smart Dictionary & Learning</p>
        <input type="text" id="loginName" placeholder="Enter your name" style="text-align:center;">
        <button class="btn" onclick="login()">Start Learning</button>
    </div>

    <div class="card-container hidden" id="appPanel">
        <div class="user-badge" onclick="logout()" title="Logout"><span id="displayUser">User</span></div>
        
        <div class="nav-bar">
            <button class="nav-btn active" onclick="switchTab('editor')">Library</button>
            <button class="nav-btn" onclick="switchTab('flashcards')">Flashcards</button>
            <button class="nav-btn" onclick="switchTab('community')">Leaderboard</button>
        </div>

        <div id="tab-editor">
            <div class="row">
                <input type="text" id="inpWord" placeholder="English Word" style="flex:2">
                <button class="btn btn-outline small-btn" onclick="autoFillSingle()" style="flex:1">Auto-Fill</button>
            </div>
            <input type="text" id="inpZh" placeholder="Chinese Meaning">
            <div class="row">
                <input type="text" id="inpPos" placeholder="Pos (e.g. verb)" style="flex:1">
                <input type="text" id="inpPho" placeholder="/IPA/" style="flex:1">
            </div>
            <textarea id="inpEx" rows="2" placeholder="Example sentence..."></textarea>
            
            <div class="row">
                <button class="btn" id="btnSave" onclick="saveOrUpdateWord()">Add Word</button>
                <button class="btn btn-outline hidden" id="btnCancelEdit" onclick="cancelEdit()" style="background:#f0f0f0; border-color:#ccc; color:#666;">Cancel</button>
            </div>

            <div class="word-list" style="margin-top: 30px;">
                <div class="sort-bar">
                    <span>My List</span>
                    <button id="sortBtn" onclick="toggleSort()" style="background:none; border:none; color:var(--primary-brown); cursor:pointer; font-weight:bold;">Sort: Time ‚Üì</button>
                </div>
                <div id="myListDisplay"></div>
            </div>

            <div class="bulk-box">
                <span style="font-weight:bold; color:var(--text-dark); display:block; margin-bottom:5px;">üöÄ Smart Bulk Import</span>
                <span style="font-size:0.85rem; color:var(--text-light); display:block; margin-bottom:10px;">Format: <b>English, Chinese</b> (One per line).<br>Duplicates will be skipped.</span>
                
                <textarea id="bulkText" rows="4" placeholder="apple, ËòãÊûú&#10;run, Ë∑ë"></textarea>
                <button class="btn btn-outline" onclick="processBulkSmart()">‚ú® Auto-Detect & Import</button>
                <div id="bulkLoading" class="loading-overlay hidden">Processing...</div>
            </div>
        </div>

        <div id="tab-flashcards" class="hidden" style="text-align:center;">
            <div class="scene">
                <div class="card-3d" id="flashcardElement" onclick="flipCard()">
                    <div class="card-face face-front">
                        <div class="fc-word" id="fcFrontWord">Start</div>
                        <div class="fc-pos" id="fcFrontPos">Press Next or ‚Üí</div>
                    </div>
                    <div class="card-face face-back">
                        <div class="fc-word" id="fcBackZh"></div>
                        <div class="fc-ex" id="fcBackEx"></div>
                    </div>
                </div>
            </div>
            
            <div class="fc-controls">
                <button class="btn btn-outline" onclick="prevCard()">‚Üê Prev</button>
                <button class="btn btn-mark" onclick="markCurrentHard()" title="Mark as hard to memorize">‚≠ê Mark Hard</button>
                <button class="btn" onclick="nextCard()">Next ‚Üí</button>
            </div>
        </div>

        <div id="tab-community" class="hidden">
            <h3>Leaderboard</h3>
            <div id="leaderboardList"></div>
            <div style="margin-top:20px; padding-top:20px; border-top:1px dashed #dcd3cb;">
                <button class="btn btn-outline small-btn" onclick="exportData()">Copy Code</button>
                <button class="btn btn-outline small-btn" onclick="importData()" style="margin-top:10px;">Import Code</button>
            </div>
        </div>
    </div>

    <script>
        let currentUser = "";
        let myLibrary = [];
        
        // ÁãÄÊÖãËÆäÊï∏
        let studyQueue = []; 
        let currentQueueIndex = -1; 
        let currentTab = 'login'; 
        let editingId = null; // Ê≠£Âú®Á∑®ËºØÁöÑÂñÆÂ≠ó ID
        let sortByHardest = false; // ÊéíÂ∫èÊ®°Âºè

        // --- ÁôªÂÖ•ËàáÂü∫Á§é ---
        function login() {
            const name = document.getElementById("loginName").value.trim();
            if(!name) return;
            currentUser = name;
            const saved = localStorage.getItem("vocab_" + currentUser);
            myLibrary = saved ? JSON.parse(saved) : [];
            // Á¢∫‰øùËàäË≥áÊñôÊúâ markCount Ê¨Ñ‰Ωç
            myLibrary.forEach(w => { if(typeof w.markCount === 'undefined') w.markCount = 0; });

            document.getElementById("displayUser").innerText = currentUser;
            document.getElementById("loginPanel").classList.add("hidden");
            document.getElementById("appPanel").classList.remove("hidden");
            renderMyList();
            renderLeaderboard();
            currentTab = 'editor';
        }

        function logout() { location.reload(); }

        function saveToLocal() {
            localStorage.setItem("vocab_" + currentUser, JSON.stringify(myLibrary));
            renderLeaderboard();
        }

        // --- API ÊäìÂèñ ---
        async function fetchWordData(word) {
            try {
                const res = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
                if(!res.ok) throw new Error("Not found");
                const data = await res.json();
                const meaning = data[0].meanings[0];
                return {
                    pos: meaning.partOfSpeech || "noun",
                    pho: data[0].phonetic || "",
                    ex: meaning.definitions[0].example || "No example found."
                };
            } catch (e) { return null; }
        }

        // --- Á∑®ËºØÂô®ÈÇèËºØ ---
        async function autoFillSingle() {
            const w = document.getElementById("inpWord").value.trim();
            if(!w) return;
            const data = await fetchWordData(w);
            if(data) {
                document.getElementById("inpPos").value = data.pos;
                document.getElementById("inpPho").value = data.pho;
                document.getElementById("inpEx").value = data.ex;
            } else {
                alert("Word not found in database.");
            }
        }

        // Êï¥ÂêàÔºöÊñ∞Â¢ûÊàñÊõ¥Êñ∞
        function saveOrUpdateWord() {
            const word = document.getElementById("inpWord").value.trim();
            const zh = document.getElementById("inpZh").value.trim();
            if(!word || !zh) return alert("Word & Meaning required.");

            // 1. Êõ¥Êñ∞Ê®°Âºè
            if (editingId) {
                const index = myLibrary.findIndex(w => w.id === editingId);
                if (index !== -1) {
                    myLibrary[index].word = word;
                    myLibrary[index].zh = zh;
                    myLibrary[index].pos = document.getElementById("inpPos").value;
                    myLibrary[index].pho = document.getElementById("inpPho").value;
                    myLibrary[index].ex = document.getElementById("inpEx").value;
                    saveToLocal();
                    renderMyList();
                    cancelEdit(); // ÈÄÄÂá∫Á∑®ËºØÊ®°Âºè
                }
            } 
            // 2. Êñ∞Â¢ûÊ®°Âºè
            else {
                // ÈáçË§áÊ™¢Êü•
                if (myLibrary.some(w => w.word.toLowerCase() === word.toLowerCase())) {
                    return alert(`The word "${word}" already exists!`);
                }

                addWordToLib(
                    word, zh, 
                    document.getElementById("inpPos").value || "noun",
                    document.getElementById("inpPho").value, 
                    document.getElementById("inpEx").value
                );
                // Ê∏ÖÁ©∫
                document.getElementById("inpWord").value = ""; 
                document.getElementById("inpZh").value = ""; 
                document.getElementById("inpPos").value = ""; 
                document.getElementById("inpEx").value = ""; 
                document.getElementById("inpPho").value = "";
            }
        }

        function addWordToLib(word, zh, pos, pho, ex) {
            myLibrary.unshift({
                id: Date.now() + Math.random(),
                word, zh, pos, pho, ex,
                markCount: 0 // ÂàùÂßãÂåñÊ®ôË®òÊ¨°Êï∏
            });
            saveToLocal();
            renderMyList();
        }

        // --- Á∑®ËºØÂäüËÉΩ ---
        function editWord(id) {
            const item = myLibrary.find(w => w.id === id);
            if(!item) return;

            // Â°´ÂÖ•Ë≥áÊñôÂà∞Ëº∏ÂÖ•Ê°Ü
            document.getElementById("inpWord").value = item.word;
            document.getElementById("inpZh").value = item.zh;
            document.getElementById("inpPos").value = item.pos;
            document.getElementById("inpPho").value = item.pho;
            document.getElementById("inpEx").value = item.ex;

            // ÂàáÊèõÊåâÈàïÁãÄÊÖã
            editingId = id;
            document.getElementById("btnSave").innerText = "Update Word";
            document.getElementById("btnCancelEdit").classList.remove("hidden");
            window.scrollTo({ top: 0, behavior: 'smooth' }); // Êç≤ÂãïÂà∞‰∏äÊñπ
        }

        function cancelEdit() {
            editingId = null;
            document.getElementById("btnSave").innerText = "Add Word";
            document.getElementById("btnCancelEdit").classList.add("hidden");
            document.getElementById("inpWord").value = "";
            document.getElementById("inpZh").value = "";
            document.getElementById("inpPos").value = "";
            document.getElementById("inpPho").value = "";
            document.getElementById("inpEx").value = "";
        }

        // --- Êô∫ÊÖßÂ§ßÈáèÂåØÂÖ• ---
        async function processBulkSmart() {
            const text = document.getElementById("bulkText").value.trim();
            if(!text) return alert("Please paste word list first!");

            const lines = text.split("\n");
            const loading = document.getElementById("bulkLoading");
            loading.classList.remove("hidden");
            loading.innerText = `Processing...`;

            let count = 0;
            let skipped = 0;
            
            for (let i = 0; i < lines.length; i++) {
                let line = lines[i].trim();
                if(!line) continue;
                let parts = line.split(/,|Ôºå/);

                if(parts.length >= 2) {
                    const w = parts[0].trim();
                    const z = parts[1].trim();

                    if(w && z) {
                        // Ê™¢Êü•ÈáçË§á
                        if (myLibrary.some(item => item.word.toLowerCase() === w.toLowerCase())) {
                            skipped++;
                            continue;
                        }

                        loading.innerText = `Fetching: ${w}`;
                        const apiData = await fetchWordData(w);
                        addWordToLib(w, z, apiData ? apiData.pos : "noun", apiData ? apiData.pho : "", apiData ? apiData.ex : "");
                        count++;
                        await new Promise(r => setTimeout(r, 200)); 
                    }
                }
            }

            loading.classList.add("hidden");
            alert(`Imported: ${count}\nSkipped (Duplicates): ${skipped}`);
            document.getElementById("bulkText").value = "";
        }

        function deleteWord(id) {
            if(!confirm("Delete?")) return;
            myLibrary = myLibrary.filter(w => w.id !== id);
            // Â¶ÇÊûúÂà™Èô§‰∫ÜÊ≠£Âú®Á∑®ËºØÁöÑÂ≠óÔºåÂèñÊ∂àÁ∑®ËºØÊ®°Âºè
            if (editingId === id) cancelEdit();
            saveToLocal(); renderMyList();
        }

        // --- ÂàóË°®Ê∏≤Êüì & ÊéíÂ∫è ---
        function toggleSort() {
            sortByHardest = !sortByHardest;
            document.getElementById("sortBtn").innerText = sortByHardest ? "Sort: Hardest ‚≠ê" : "Sort: Time ‚Üì";
            renderMyList();
        }

        function renderMyList() {
            const list = document.getElementById("myListDisplay");
            list.innerHTML = "";
            
            // Ë§áË£Ω‰∏Ä‰ªΩÈô£Âàó‰æÜÊéíÂ∫èÔºå‰∏çÂΩ±ÈüøÂéüÂßãË≥áÊñô
            let displayList = [...myLibrary];
            
            if (sortByHardest) {
                // ‰æùÊ®ôË®òÊ¨°Êï∏ÈôçÂÜ™ÊéíÂ∫è
                displayList.sort((a, b) => b.markCount - a.markCount);
            } else {
                // ‰æùÊôÇÈñì(È†êË®≠)‰∏çÈúÄË¶ÅÂãïÔºåÂõ†ÁÇ∫ÊàëÂÄëÊòØunshiftÈÄ≤ÂéªÁöÑ
            }

            displayList.forEach(item => {
                const cambridgeUrl = `https://dictionary.cambridge.org/dictionary/english/${item.word.toLowerCase()}`;
                
                // È°ØÁ§∫Ê®ôË®òÊ¨°Êï∏ (Âè™ÊúâÂ§ßÊñº0ÊâçÈ°ØÁ§∫)
                const starDisplay = item.markCount > 0 ? `<span class="star-badge">‚≠ê ${item.markCount}</span>` : '';

                list.innerHTML += `
                    <div class="word-item">
                        <div style="flex:1">
                            <div style="display:flex; align-items:center; gap:10px;">
                                <strong style="font-size:1.1rem; color:var(--primary-brown);">${item.word}</strong> 
                                <small style="color:var(--text-light)">${item.pos}</small>
                                <a href="${cambridgeUrl}" target="_blank" class="cambridge-link" title="Open Cambridge Dictionary">C</a>
                                ${starDisplay}
                            </div>
                            <div style="margin-top:3px;">${item.zh}</div>
                        </div>
                        <div class="action-group">
                            <button class="edit-btn" onclick="editWord(${item.id})">Edit</button>
                            <button class="del-btn" onclick="deleteWord(${item.id})">&times;</button>
                        </div>
                    </div>`;
            });
        }

        // --- Flashcard ÈÇèËºØ ---
        function initFlashcards() {
            if(myLibrary.length === 0) return;
            // ÂÑ™ÂÖàË§áÁøíÊ®ôË®òÊ¨°Êï∏È´òÁöÑÂñÆÂ≠óÔºå‰ΩÜÈÇÑÊòØ‰øùÊåÅÈö®Ê©üÊÄß (Ê∑∑ÂêàÊ¨äÈáçÊúÉÂ§™Ë§áÈõúÔºåÈÄôË£°Á∂≠ÊåÅÈö®Ê©ü)
            studyQueue = [...myLibrary].sort(() => 0.5 - Math.random());
            currentQueueIndex = -1;
            nextCard();
        }

        function nextCard() {
            if(myLibrary.length === 0) return alert("Library empty.");
            if (studyQueue.length === 0 || currentQueueIndex >= studyQueue.length - 1) {
                studyQueue = [...myLibrary].sort(() => 0.5 - Math.random());
                currentQueueIndex = -1;
            }
            currentQueueIndex++;
            flipBackAndUpdate(studyQueue[currentQueueIndex]);
        }

        function prevCard() {
            if(currentQueueIndex <= 0) return; 
            currentQueueIndex--;
            flipBackAndUpdate(studyQueue[currentQueueIndex]);
        }

        function flipBackAndUpdate(item) {
            const card = document.getElementById("flashcardElement");
            if (card.classList.contains('is-flipped')) {
                card.classList.remove('is-flipped');
                setTimeout(() => updateCardContent(item), 300);
            } else {
                updateCardContent(item);
            }
        }

        function updateCardContent(item) {
            document.getElementById("fcFrontWord").innerText = item.word;
            document.getElementById("fcFrontPos").innerText = `(${item.pos})`;
            document.getElementById("fcBackZh").innerText = item.zh;
            document.getElementById("fcBackEx").innerText = item.ex || "No example available.";
        }

        function flipCard() {
            document.getElementById("flashcardElement").classList.toggle("is-flipped");
        }

        // Ê®ôË®òÈõ£Â≠ó
        function markCurrentHard() {
            if (currentQueueIndex === -1 || !studyQueue[currentQueueIndex]) return;
            
            const currentItem = studyQueue[currentQueueIndex];
            // ÊâæÂà∞ÂéüÂßãË≥áÊñôÂ∫´‰∏≠ÁöÑË©≤Áâ©‰ª∂‰∏¶Êõ¥Êñ∞
            const originalItem = myLibrary.find(w => w.id === currentItem.id);
            if (originalItem) {
                originalItem.markCount = (originalItem.markCount || 0) + 1;
                saveToLocal();
                alert(`Marked "${originalItem.word}" as hard! (Total: ${originalItem.markCount})`);
            }
        }

        // ÈçµÁõ§Êìç‰Ωú
        document.addEventListener('keydown', (e) => {
            if (currentTab !== 'flashcards') return;
            if (e.key === "Enter") { e.preventDefault(); flipCard(); } 
            else if (e.key === "ArrowRight") { nextCard(); } 
            else if (e.key === "ArrowLeft") { prevCard(); }
        });

        // UI ÂàáÊèõ
        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll(".nav-btn").forEach(b => b.classList.remove("active"));
            event.target.classList.add("active");
            ['editor', 'flashcards', 'community'].forEach(t => document.getElementById(`tab-${t}`).classList.add("hidden"));
            document.getElementById(`tab-${tab}`).classList.remove("hidden");
            
            if(tab === 'community') renderLeaderboard();
            if(tab === 'editor') renderMyList(); // ÂàáÊèõÂõûÂàóË°®ÊôÇÈáçÊñ∞Ê∏≤Êüì‰ª•Êõ¥Êñ∞ÊéíÂ∫è
            if(tab === 'flashcards') {
                if(currentQueueIndex === -1 && myLibrary.length > 0) initFlashcards();
            }
        }

        // Á§æÁæ§
        function renderLeaderboard() {
            const list = document.getElementById("leaderboardList");
            list.innerHTML = `<div class="word-item"><div><strong>${currentUser} (You)</strong></div><div>${myLibrary.length} words</div></div>`;
        }
        function exportData() { navigator.clipboard.writeText(JSON.stringify(myLibrary)).then(() => alert("Code copied.")); }
        function importData() {
            const code = prompt("Paste code:");
            if(!code) return;
            try {
                const newWords = JSON.parse(code);
                newWords.forEach(nw => { if(!myLibrary.some(e => e.word === nw.word)) myLibrary.unshift(nw); });
                saveToLocal(); renderMyList();
                alert("Imported!");
            } catch(e) { alert("Invalid code."); }
        }
    </script>
</body>
</html>
